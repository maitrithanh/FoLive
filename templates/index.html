<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoLive - Livestream 24/7 Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .header .stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .stat-item {
            padding: 10px 15px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        
        .stat-item .label {
            font-size: 12px;
            color: #666;
        }
        
        .stat-item .value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .panel h2 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
        }
        
        .streams-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .stream-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        
        .stream-item.running {
            border-left-color: #27ae60;
        }
        
        .stream-item.error {
            border-left-color: #e74c3c;
        }
        
        .stream-item.stopped {
            border-left-color: #95a5a6;
        }
        
        .stream-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .stream-id {
            font-weight: bold;
            color: #333;
        }
        
        .stream-status {
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-idle { background: #ecf0f1; color: #7f8c8d; }
        .status-starting { background: #fff3cd; color: #856404; }
        .status-running { background: #d4edda; color: #155724; }
        .status-stopping { background: #fff3cd; color: #856404; }
        .status-stopped { background: #f8d7da; color: #721c24; }
        .status-error { background: #f8d7da; color: #721c24; }
        
        .stream-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .stream-info div {
            margin-bottom: 5px;
        }
        
        .config-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .config-section h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé• FoLive - Livestream 24/7 Manager</h1>
            <div class="stats">
                <div class="stat-item">
                    <div class="label">T·ªïng Streams</div>
                    <div class="value" id="total-streams">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">ƒêang ch·∫°y</div>
                    <div class="value" id="running-streams">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">FFmpeg</div>
                    <div class="value" id="ffmpeg-status">Checking...</div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <h2>‚ûï T·∫°o Stream M·ªõi</h2>
                <div id="alert-container"></div>
                
                <form id="stream-form">
                    <div class="form-group">
                        <label>Stream ID *</label>
                        <input type="text" id="stream-id" required placeholder="stream-1">
                    </div>
                    
                    <div class="form-group">
                        <label>Lo·∫°i ngu·ªìn *</label>
                        <select id="source-type" required>
                            <option value="file">File Video</option>
                            <option value="youtube">YouTube Video</option>
                            <option value="playlist">YouTube Playlist</option>
                            <option value="screen">Quay m√†n h√¨nh</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Ngu·ªìn *</label>
                        <input type="text" id="source" required 
                               placeholder="ƒê∆∞·ªùng d·∫´n file ho·∫∑c URL">
                    </div>
                    
                    <div class="form-group">
                        <label>Stream URL (RTMP) *</label>
                        <input type="text" id="stream-url" required 
                               placeholder="rtmp://a.rtmp.youtube.com/live2">
                    </div>
                    
                    <div class="form-group">
                        <label>Stream Key *</label>
                        <input type="text" id="stream-key" required 
                               placeholder="YouTube stream key">
                    </div>
                    
                    <div class="config-section">
                        <h3>‚öôÔ∏è C·∫•u h√¨nh n√¢ng cao</h3>
                        
                        <div class="config-grid">
                            <div class="form-group">
                                <label>Bitrate (k)</label>
                                <input type="number" id="bitrate" value="2500">
                            </div>
                            
                            <div class="form-group">
                                <label>T·ªëc ƒë·ªô ph√°t (1.0 = b√¨nh th∆∞·ªùng)</label>
                                <input type="number" id="speed" step="0.1" value="1.0">
                            </div>
                            
                            <div class="form-group">
                                <label>√Çm l∆∞·ª£ng (1.0 = 100%)</label>
                                <input type="number" id="volume" step="0.1" value="1.0">
                            </div>
                            
                            <div class="form-group">
                                <label>ƒê·ªô s√°ng (-100 ƒë·∫øn 100)</label>
                                <input type="number" id="brightness" value="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Ch√®n ch·ªØ</label>
                            <input type="text" id="text" placeholder="Text overlay">
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="loop" checked>
                                <label for="loop">L·∫∑p l·∫°i v√¥ h·∫°n (24/7)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">T·∫°o Stream</button>
                        <button type="button" class="btn btn-secondary" onclick="validateSource()">Ki·ªÉm tra ngu·ªìn</button>
                    </div>
                </form>
            </div>
            
            <div class="panel">
                <h2>üì∫ Danh s√°ch Streams</h2>
                <div id="streams-list" class="streams-list">
                    <p style="text-align: center; color: #999; padding: 20px;">
                        Ch∆∞a c√≥ stream n√†o. T·∫°o stream m·ªõi ·ªü b√™n tr√°i.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let streams = [];
        
        // Load streams on page load
        window.addEventListener('DOMContentLoaded', () => {
            checkSystem();
            loadStreams();
            setInterval(loadStreams, 3000); // Refresh every 3 seconds
        });
        
        // Form submission
        document.getElementById('stream-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const streamId = document.getElementById('stream-id').value;
            const sourceType = document.getElementById('source-type').value;
            const source = document.getElementById('source').value;
            const streamUrl = document.getElementById('stream-url').value;
            const streamKey = document.getElementById('stream-key').value;
            
            const config = {
                bitrate: document.getElementById('bitrate').value + 'k',
                speed: parseFloat(document.getElementById('speed').value),
                volume: parseFloat(document.getElementById('volume').value),
                brightness: parseInt(document.getElementById('brightness').value),
                loop: document.getElementById('loop').checked,
                text: document.getElementById('text').value || null
            };
            
            try {
                const response = await fetch('/api/streams', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        stream_id: streamId,
                        source: source,
                        source_type: sourceType,
                        stream_key: streamKey,
                        stream_url: streamUrl,
                        config: config
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showAlert('T·∫°o stream th√†nh c√¥ng!', 'success');
                    document.getElementById('stream-form').reset();
                    loadStreams();
                } else {
                    showAlert('L·ªói: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('L·ªói k·∫øt n·ªëi: ' + error.message, 'error');
            }
        });
        
        async function loadStreams() {
            try {
                const response = await fetch('/api/streams');
                const data = await response.json();
                
                if (data.success) {
                    streams = data.streams;
                    renderStreams();
                    updateStats();
                }
            } catch (error) {
                console.error('Error loading streams:', error);
            }
        }
        
        function renderStreams() {
            const container = document.getElementById('streams-list');
            
            if (streams.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Ch∆∞a c√≥ stream n√†o. T·∫°o stream m·ªõi ·ªü b√™n tr√°i.</p>';
                return;
            }
            
            container.innerHTML = streams.map(stream => `
                <div class="stream-item ${stream.status}">
                    <div class="stream-header">
                        <span class="stream-id">${stream.stream_id}</span>
                        <span class="stream-status status-${stream.status}">${getStatusText(stream.status)}</span>
                    </div>
                    <div class="stream-info">
                        <div><strong>Ngu·ªìn:</strong> ${stream.source_type} - ${stream.source.substring(0, 50)}...</div>
                        <div><strong>Th·ªùi gian:</strong> ${formatDuration(stream.duration)}</div>
                        ${stream.error_message ? `<div style="color: #e74c3c;"><strong>L·ªói:</strong> ${stream.error_message}</div>` : ''}
                    </div>
                    <div class="btn-group">
                        ${stream.status === 'running' 
                            ? `<button class="btn btn-danger" onclick="stopStream('${stream.stream_id}')">D·ª´ng</button>`
                            : `<button class="btn btn-success" onclick="startStream('${stream.stream_id}')">B·∫Øt ƒë·∫ßu</button>`
                        }
                        <button class="btn btn-secondary" onclick="deleteStream('${stream.stream_id}')">X√≥a</button>
                    </div>
                </div>
            `).join('');
        }
        
        async function startStream(streamId) {
            try {
                const response = await fetch(`/api/streams/${streamId}/start`, {
                    method: 'POST'
                });
                const data = await response.json();
                if (data.success) {
                    showAlert('ƒê√£ b·∫Øt ƒë·∫ßu stream!', 'success');
                    loadStreams();
                } else {
                    showAlert('L·ªói: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        async function stopStream(streamId) {
            try {
                const response = await fetch(`/api/streams/${streamId}/stop`, {
                    method: 'POST'
                });
                const data = await response.json();
                if (data.success) {
                    showAlert('ƒê√£ d·ª´ng stream!', 'success');
                    loadStreams();
                } else {
                    showAlert('L·ªói: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        async function deleteStream(streamId) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a stream n√†y?')) return;
            
            try {
                const response = await fetch(`/api/streams/${streamId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                if (data.success) {
                    showAlert('ƒê√£ x√≥a stream!', 'success');
                    loadStreams();
                } else {
                    showAlert('L·ªói: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        async function validateSource() {
            const sourceType = document.getElementById('source-type').value;
            const source = document.getElementById('source').value;
            
            if (!source) {
                showAlert('Vui l√≤ng nh·∫≠p ngu·ªìn', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/sources/validate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({source_type: sourceType, source: source})
                });
                
                const data = await response.json();
                if (data.success && data.valid) {
                    showAlert('Ngu·ªìn h·ª£p l·ªá!', 'success');
                } else {
                    showAlert('Ngu·ªìn kh√¥ng h·ª£p l·ªá', 'error');
                }
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        async function checkSystem() {
            try {
                const response = await fetch('/api/system/check');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('ffmpeg-status').textContent = 
                        data.ffmpeg_available ? '‚úì S·∫µn s√†ng' : '‚úó Kh√¥ng t√¨m th·∫•y';
                }
            } catch (error) {
                console.error('Error checking system:', error);
            }
        }
        
        function updateStats() {
            document.getElementById('total-streams').textContent = streams.length;
            document.getElementById('running-streams').textContent = 
                streams.filter(s => s.status === 'running').length;
        }
        
        function getStatusText(status) {
            const statusMap = {
                'idle': 'Ch·ªù',
                'starting': 'ƒêang kh·ªüi ƒë·ªông',
                'running': 'ƒêang ch·∫°y',
                'stopping': 'ƒêang d·ª´ng',
                'stopped': 'ƒê√£ d·ª´ng',
                'error': 'L·ªói'
            };
            return statusMap[status] || status;
        }
        
        function formatDuration(seconds) {
            if (!seconds) return '0s';
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            if (h > 0) return `${h}h ${m}m ${s}s`;
            if (m > 0) return `${m}m ${s}s`;
            return `${s}s`;
        }
        
        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.innerHTML = '';
            container.appendChild(alert);
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
    </script>
</body>
</html>


